<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<title>Megalophone</title>
	<meta name="description" content="An educational and live in-browser synth?" />
	<style>
		body, button {
			text-align: center;
			font-size:50px;
			padding: 0.2em;
		}
	</style>
</head>

<body>

	<h1>Megalophone</h1>
	<button id="play" accesskey="p">Play</button>
	<button id="stop" accesskey="s">Stop</button>
	<div>
  	<label for="freq">Filter Freq</label>:
  	<input type="range" id="freq" name="freq" min="50" max="6000" />
	</div>

	<script type="module">
		import Megalophone from './js/megalophone/megalophone.js';
		const mega = new Megalophone(new AudioContext());
		let playing = false;
		function* notes() {
			while (true) {
				yield 110;
				yield 220;
				yield 440;
				yield 110 * 1.05;
			}
		}
		document.querySelector('#stop').addEventListener('click', async e => {
			playing = false;
		});
		document.querySelector('#play').addEventListener('click', async e => {
			if(playing) return;
			playing = true;
			const gen = notes();
			const periodMsec = 160;
			const tick = function () {
				setTimeout(() => {
					mega.play(gen.next().value, periodMsec / 1000.0);
					if(playing) tick();
				}, periodMsec);
			};
			tick();
		});
		document.querySelector('#freq').addEventListener('input', async e => {
			mega.setFilterFreq(e.target.value);
		});
	</script>
</body>

</html>
